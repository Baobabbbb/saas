import{s as t}from"./supabaseClient-84cb7855.js";import"./preload-helper-8235fac6.js";console.log("ğŸš€ FRIDAY: Service crÃ©ations - SUPABASE ONLY MODE");async function i(){var r;try{const{data:{session:e},error:o}=await t.auth.getSession();if((r=e==null?void 0:e.user)!=null&&r.id)return console.log("ğŸ‘¤ FRIDAY: ID utilisateur rÃ©cupÃ©rÃ© depuis session Supabase:",e.user.id),e.user.id;const a=localStorage.getItem("friday_user_cache");if(a){const s=JSON.parse(a);if(s.id)return console.log("ğŸ‘¤ FRIDAY: ID utilisateur rÃ©cupÃ©rÃ© depuis cache:",s.id),s.id}return console.warn("âš ï¸ FRIDAY: Aucun ID utilisateur trouvÃ©"),null}catch(e){return console.error("âŒ FRIDAY: Erreur rÃ©cupÃ©ration ID utilisateur:",e),null}}async function R({type:r,title:e,data:o}){console.log("ğŸ’¾ FRIDAY: Sauvegarde crÃ©ation en base Supabase",{type:r,title:e});const a=await i();if(!a)throw console.warn("âš ï¸ FRIDAY: Impossible de sauvegarder - pas d'ID utilisateur"),new Error("Utilisateur non connectÃ©");try{const s={user_id:a,type:r,title:e,data:{...o,created_via:"friday_web",user_email:localStorage.getItem("userEmail")||"anonymous",timestamp:new Date().toISOString()}};console.log("ğŸ“¤ Envoi vers Supabase:",s);const{data:c,error:n}=await t.from("creations").insert([s]).select().single();if(n)throw console.error("âŒ ERREUR Supabase lors de la crÃ©ation:",n),console.error("ğŸ” FRIDAY: DÃ©tails erreur Supabase:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),console.error("ğŸ“„ FRIDAY: DonnÃ©es envoyÃ©es:",s),new Error(`Erreur base de donnÃ©es: ${n.message}`);return console.log("âœ… CrÃ©ation sauvegardÃ©e en base:",c),c}catch(s){throw console.error("âŒ ERREUR CRITIQUE lors de la sauvegarde:",s),s}}async function u(){console.log("ğŸ“¥ FRIDAY: RÃ©cupÃ©ration crÃ©ations depuis Supabase");const r=await i();if(!r)return console.warn("âš ï¸ FRIDAY: Impossible de rÃ©cupÃ©rer les crÃ©ations - pas d'ID utilisateur"),[];try{console.log("ğŸ” FRIDAY: Recherche crÃ©ations pour user_id:",r);const{data:e,error:o}=await t.from("creations").select("*").eq("user_id",r).order("created_at",{ascending:!1});if(o)throw console.error("âŒ ERREUR Supabase lors de la rÃ©cupÃ©ration:",o),new Error(`Erreur base de donnÃ©es: ${o.message}`);return console.log(`âœ… ${(e==null?void 0:e.length)||0} crÃ©ations rÃ©cupÃ©rÃ©es de la base`),e||[]}catch(e){throw console.error("âŒ ERREUR CRITIQUE lors de la rÃ©cupÃ©ration:",e),e}}const p=u;async function g(r){console.log("ğŸ—‘ï¸ FRIDAY: Suppression crÃ©ation de Supabase, ID:",r);try{const{error:e}=await t.from("creations").delete().eq("id",r);if(e)throw console.error("âŒ ERREUR Supabase lors de la suppression:",e),new Error(`Erreur base de donnÃ©es: ${e.message}`);return console.log("âœ… CrÃ©ation supprimÃ©e de la base"),!0}catch(e){throw console.error("âŒ ERREUR CRITIQUE lors de la suppression:",e),e}}async function I(r,e){console.log("ğŸ“ FRIDAY: Mise Ã  jour crÃ©ation en base, ID:",r);try{const{data:o,error:a}=await t.from("creations").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw console.error("âŒ ERREUR Supabase lors de la mise Ã  jour:",a),new Error(`Erreur base de donnÃ©es: ${a.message}`);return console.log("âœ… CrÃ©ation mise Ã  jour en base:",o),o}catch(o){throw console.error("âŒ ERREUR CRITIQUE lors de la mise Ã  jour:",o),o}}async function E(r){console.log("ğŸ” FRIDAY: RÃ©cupÃ©ration crÃ©ation spÃ©cifique, ID:",r);try{const{data:e,error:o}=await t.from("creations").select("*").eq("id",r).single();if(o)throw console.error("âŒ ERREUR Supabase lors de la rÃ©cupÃ©ration:",o),new Error(`Erreur base de donnÃ©es: ${o.message}`);return console.log("âœ… CrÃ©ation rÃ©cupÃ©rÃ©e:",e),e}catch(e){throw console.error("âŒ ERREUR CRITIQUE lors de la rÃ©cupÃ©ration:",e),e}}async function w(){console.log("ğŸ§ª FRIDAY: Test de connexion Supabase...");try{const{data:r,error:e,count:o}=await t.from("creations").select("*",{count:"exact",head:!0});return e?(console.error("âŒ Connexion Supabase Ã©chouÃ©e:",e),{success:!1,error:e.message}):(console.log("âœ… Connexion Supabase rÃ©ussie - CrÃ©ations en base:",o),{success:!0,count:o})}catch(r){return console.error("âŒ Test connexion Ã©chouÃ©:",r),{success:!1,error:r.message}}}console.log("âœ… FRIDAY: Service crÃ©ations initialisÃ© - Mode Supabase uniquement");export{R as addCreation,g as deleteCreation,E as getCreation,u as getCreations,p as getUserCreations,w as testSupabaseConnection,I as updateCreation};

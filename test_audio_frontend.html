<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Audio Udio - Frontend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .audio-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }
        .correct { border-color: #28a745; background: #d4edda; }
        .incorrect { border-color: #dc3545; background: #f8d7da; }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .url-display {
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéµ Test d'affichage audio Udio - Correction Frontend</h1>
        
        <p><strong>Comptine g√©n√©r√©e :</strong> "√âtoiles d'Or" (Berceuse)</p>
        <p><strong>URL Udio :</strong></p>
        <div class="url-display" id="audioUrl">
            https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/3c179c85b67c4518982d69d1b31b827e/1/The%2520Untitled.mp3
        </div>
        
        <div class="audio-test incorrect">
            <h3>‚ùå Avant (incorrect) - M√©thode ancienne</h3>
            <p>Le frontend pr√©fixait l'URL avec localhost :</p>
            <div class="url-display">
                http://localhost:8000/https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/3c179c85b67c4518982d69d1b31b827e/1/The%2520Untitled.mp3
            </div>
            <audio controls>
                <source src="http://localhost:8000/https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/3c179c85b67c4518982d69d1b31b827e/1/The%2520Untitled.mp3" type="audio/mpeg">
                Votre navigateur ne supporte pas l'audio.
            </audio>
            <p><em>‚Üí R√©sultat : URL malform√©e, audio 0:00/0:00</em></p>
        </div>
        
        <div class="audio-test correct">
            <h3>‚úÖ Apr√®s (correct) - Nouvelle m√©thode</h3>
            <p>Le frontend utilise directement l'URL Udio compl√®te :</p>
            <div class="url-display">
                https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/3c179c85b67c4518982d69d1b31b827e/1/The%2520Untitled.mp3
            </div>
            <audio controls>
                <source src="https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/3c179c85b67c4518982d69d1b31b827e/1/The%2520Untitled.mp3" type="audio/mpeg">
                Votre navigateur ne supporte pas l'audio.
            </audio>
            <p><em>‚Üí R√©sultat : Audio fonctionnel avec dur√©e correcte (~2min11s)</em></p>
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #e7f3ff; border-radius: 6px;">
            <h3>üîß Corrections apport√©es dans App.jsx :</h3>
            <ol>
                <li><strong>Comptines :</strong> 
                    <code>src={generatedResult.audio_path || generatedResult.audio_url}</code>
                    <br><em>(au lieu de src={`http://localhost:8000/${generatedResult.audio_path}`})</em>
                </li>
                <li><strong>Autres contenus :</strong> 
                    <code>src={generatedResult.audio_path || generatedResult.audio_url}</code>
                    <br><em>(m√™me correction)</em>
                </li>
                <li><strong>Conditions :</strong> V√©rification des deux champs audio_path ET audio_url</li>
                <li><strong>Polling :</strong> Mise √† jour correcte avec l'URL compl√®te</li>
            </ol>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 6px;">
            <h3>‚úÖ R√©sultat :</h3>
            <p>Le lecteur audio affiche maintenant la dur√©e correcte et permet la lecture de la comptine Udio !</p>
        </div>
    </div>
    
    <script>
        // Test automatique pour v√©rifier si l'audio se charge
        const correctAudio = document.querySelector('.correct audio');
        const incorrectAudio = document.querySelector('.incorrect audio');
        
        correctAudio.addEventListener('loadedmetadata', () => {
            console.log('‚úÖ Audio correct charg√© - Dur√©e:', correctAudio.duration, 'secondes');
        });
        
        correctAudio.addEventListener('error', (e) => {
            console.log('‚ùå Erreur audio correct:', e);
        });
        
        incorrectAudio.addEventListener('error', (e) => {
            console.log('‚ùå Erreur audio incorrect (attendue):', e);
        });
    </script>
</body>
</html>
